---
title: "Penanganan Autokorelasi"
author: "Wiska Radhia Firdaus"
date: "2025-09-01"
output: html_document
---

# Library & Input Data

```{r}
library(readxl)
library(TTR)
library(forecast)

df <- read_excel("C:\\Users\\MyBook Z Series\\Downloads\\IPM BALI.xlsx")
df <- as.data.frame(df)
df
```

Data yang digunakan adalah data IPM Provinsi Bali Tahun 2010 hingga 2024.

# Eksplorasi Data

```{r}
data.ts <- ts(df$IPM)
data.ts
```

```{r}
ts.plot(data.ts, xlab="Time Period ", ylab="IPM", main= "Time Series Plot of IPM")
points(data.ts)
```

Berikut merupakan plot dari IPM Provinsi Bali yang cenderung berupa tren naik.

# Regresi

```{r}
model <- lm(formula = IPM ~ Tahun, data = df)
summary(model)
```

Pada hasil regresi diatas diperoleh $R^2=0.9912$ sebesar 0.9912 yang artinya sebesar 99.12% keragaman IPM di Provinsi Bali dapat dijelaskan oleh peubah Tahun. Selain itu juga memiliki nilai $\textit{p-value}$ < $\alpha$ (5%) sehingga  nyata dalam taraf 5%. Selanjutnya akan dilakukan uji terhadap sisaannya.

```{r}
sisaan<- residuals(model)
fitValue<- predict(model)

par(mfrow = c(2,2))
qqnorm(sisaan)
qqline(sisaan, col = "steelblue", lwd = 2)
plot(fitValue, sisaan, col = "steelblue", pch = 20, xlab = "Sisaan", ylab = "Fitted Values", main = "Sisaan vs Fitted Values")
abline(a = 0, b = 0, lwd = 2)
hist(sisaan, col = "steelblue")
plot(seq(1,15,1), sisaan, col = "steelblue", pch = 20, xlab = "Sisaan", ylab = "Order", main = "Sisaan vs Order")
lines(seq(1,15,1), sisaan, col = "red")
abline(a = 0, b = 0, lwd = 2)
```

Pada plot Normal Q-Q Plot dan histogram sisaan terlihat bahwa sisaan cenderung menyebar normal, namun pada histogram terlihat seperti memiliki dua puncak (bimodal). Kemudian pada plot Sisaan vs Fitted Values dan Sisaan vs Order terlihat bahwa sisaan membentuk suatu pola, yang artinya terdapat autokorelasi. Namun, untuk memastikannya akan dilakukan uji formal.

```{r}
shapiro.test(sisaan)
```

```{r}
ks.test(sisaan, "pnorm", mean=mean(sisaan), sd=sd(sisaan))
```

Berdasarkan uji formal Saphiro-Wilk dan Kolmogorov-Smirnov didapatkan nilai $p-value > α$ (5%). Artinya, cukup bukti untuk menyatakan bahwa sisaan berdistribusi normal.

```{r}
par(mfrow = c(1,2))
acf(sisaan)
pacf(sisaan)
```

Berdasarkan plot ACF dan PACF, terlihat semua dalam rentang batas dan tidak ada lag yang signifikan. Namun, untuk lebih memastikan akan dilakukan uji formal dengan uji Durbin Watson.

```{r}
library(lmtest)
dwtest(model)
```

Berdasarkan hasil DW Test, didapatkan nilai $dW=0.94637$ dan $p-value = 0.03741$. Berdasarkan tabel Durbin-Watson diperoleh nilai $dL=1.0770$ dan $dU=1.3605$. Nilai dW berada di bawah nilai dL. Artinya, terdapat autokorelasi positif. Juga dengan nilai $p-value < 0.05$ dapat disimpulkan bahwa tolak H0, cukup bukti mengatakan adanya autokorelasi. Oleh karena itu, diperlukan penangan autokorelasi. Penanganan yang akan digunakan menggunakan dua metode, yaitu Cochrane-Orcutt dan Hildret-Lu.

# Penanganan Autokorelasi
## Cochrane-Orcutt

```{r}
library(orcutt)
modelCO <- cochrane.orcutt(model)
modelCO
```

Hasil keluaran model setelah dilakukan penanganan adalah sebagai berikut.
$$yi = -924.881530 \ + \ 0.495301$$
Hasil juga menunjukkan bahwa nilai dW dan $p-value$ meningkat menjadi $1.75467$ dan $0.02092$. Nilai dW sudah berada pada rentang $dU < dW < 4-dU$ atau $1.3605 < dW < 2.6395$. Tetapi pada $p-value$ masih Tolak H0 yang artinya masih terdapat autokorelasi dalam taraf nyata 5% meskipun telah dilakukan penanganan, tetapi dalam taraf nyata 1% sudah tidak ada autokorelasi. Sehingga perlu metode lain untuk melakukan penanganan autokorelasinya. Kita akan melakukan penanganan menggunakan Hildreth-Lu.

## Hildreth-Lu

```{r}
hildreth.lu.func<- function(r, model){
  x <- model.matrix(model)[,-1]
  y <- model.response(model.frame(model))
  n <- length(y)
  t <- 2:n
  y <- y[t]-r*y[t-1]
  x <- x[t]-r*x[t-1]
  
  return(lm(y~x))
}

r <- c(seq(0.1,0.9, by= 0.1))
tab <- data.frame("rho" = r, "SSE" = sapply(r, function(i){deviance(hildreth.lu.func(i, model))}))
round(tab, 4)
```

Pertama-tama akan dicari di mana kira-kira $ρ$ yang menghasilkan SSE minimum. Pada hasil di atas terlihat $ρ$ minimum ketika 0.4. Namun, hasil tersebut masih kurang teliti sehingga akan dicari kembali $ρ$ yang lebih optimum dengan ketelitian yang lebih. Jika sebelumnya jarak antar $ρ$ yang dicari adalah 0.1, kali ini jarak antar $ρ$ adalah 0.001 dan dilakukan pada selang 0.2 sampai dengan 0.5.

```{r}
rOpt <- seq(0.2,0.5, by= 0.001)
tabOpt <- data.frame("rho" = rOpt, "SSE" = sapply(rOpt, function(i){deviance(hildreth.lu.func(i, model))}))
head(tabOpt[order(tabOpt$SSE),])
```

```{r}
par(mfrow = c(1,1))
plot(tab$SSE ~ tab$rho , type = "l", xlab = "Rho", ylab = "SSE")
abline(v = tabOpt[tabOpt$SSE==min(tabOpt$SSE),"rho"], lty = 2, col="red",lwd=2)
text(x=0.413, y=0.3649678, labels = "rho=0.413", cex = 0.8)
```

Perhitungan yang dilakukan menunjukkan bahwa nilai $ρ$ optimum, yaitu saat SSE terkecil terdapat pada nilai $ρ=0.413$. Hal tersebut juga ditunjukkan pada plot. Selanjutnya, model dapat didapatkan dengan mengevaluasi nilai $ρ$ ke dalam fungsi Hildreth-Lu, serta dilanjutkan dengan pengujian autokorelasi dengan uji Durbin-Watson. Namun, setelah pengecekan tersebut tidak lupa koefisien regresi tersebut digunakan untuk transformasi balik. Persamaan hasil transformasi itulah yang menjadi persamaan sesungguhnya.

```{r}
library(HoRM)
modelHL <- hildreth.lu.func(0.413, model)
summary(modelHL)
```

```{r}
cat("y = ", coef(modelHL)[1]/(1-0.413), "+", coef(modelHL)[2],"x", sep = "")
```

Setelah dilakukan tranformasi balik, didapatkan model dengan metode Hildreth-Lu sebagai berikut.
$$yi = -924.9051 \ + \ 0.4953125x_t$$

```{r}
dwtest(modelHL)
```

Hasil uji Durbin-Watson menunjukkan bawah nilai dW sebesar 1.7541 berada pada selang daerah tidak ada autokorelasi, yaitu pada rentang $dU < dW < 4-dU$ atau $1.3605 < dW < 2.6395$. Hal tersebut juga didukung oleh $p-value$ sebesar $0.2089$, di mana $p-value > α$ = 5%. Artinya tak Tolak H0 atau belum cukup bukti menyatakan bahwa ada autokorelasi dalam data nilai IPM Provinsi Bali dengan metode Hildreth-Lu pada taraf nyata 5%.
Terakhir, akan dibandingkan nilai SSE dari ketiga metode (metode awal, metode Cochrane-Orcutt, dan Hildreth-Lu).

```{r}
sseModelawal <- anova(model)$`Sum Sq`[-1]
sseModelCO <- anova(modelCOmanual)$`Sum Sq`[-1]
sseModelHL <- anova(modelHL)$`Sum Sq`[-1]
mseModelawal <- sseModelawal/length(df$IPM)
mseModelCO <- sseModelCO/length(df$IPM)
mseModelHL <- sseModelHL/length(df$IPM)
akurasi <- matrix(c(sseModelawal,sseModelCO,sseModelHL,
                    mseModelawal,mseModelCO,mseModelHL),nrow=2,ncol=3,byrow = T)
colnames(akurasi) <- c("Model Awal", "Model Cochrane-Orcutt", "Model Hildreth-Lu")
row.names(akurasi) <- c("SSE","MSE")
akurasi
```

Berdasarkan hasil tersebut dapat diketahui bahwa hasil penanganan autokorelasi dengan metode Cochrane-Orcutt memiliki SSE yang lebih kecil dari Hildreth-Lu, sebesar $0.34267474 < 0.36496366$, meskipun begitu, masih lebih baik dibandingkan model awal ketika autokorelasi masih terjadi, yaitu sebesar $0.65611857$.

# Simpulan

Autokorelasi yang terdapat pada data IPM Provinsi Bali terjadi akibat adanya korelasi di antara unsur penyusunnya. Indikator IPM yang erat hubungannya dengan perekonomian sangat rawan menjadi penyebab adanya autokorelasi. Adanya autokorelasi menyebabkan model regresi kurang baik karena akan meingkatkan galatnya. Autokorelasi dapat dideteksi secara eksploratif melalui plot sisaan, ACF, dan PACF, serta dengan uji formal Durbin-Watson. Namun, autokorelasi tersebut dapat ditangani dengan metode Cochrane-Orcutt dan Hildreth-Lu, meskipun pada taraf nyata 5% hanya Hildreth-Lu yang berhasil menangani autokorelasi, Cochrane-Orcutt tidak berhasil menangani autokorelasi pada taraf nyata 5%, melainkan pada taraf nyata 1%. Kedua metode menghasilkan nilai SSE yang berbeda, dimana nilai SSE dari Cochrane-Orcutt lebih kecil dibandingkan Hildreth-Lu. Tetapi, yang baik digunakan dengan taraf nyata 5% adalah metode Hildreth-Lu karena berhasil menangani autokorelasi dibandingkan Cochrane-Orcutt. 
